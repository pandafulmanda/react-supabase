"use strict";var U=Object.defineProperty,T=Object.defineProperties;var M=Object.getOwnPropertyDescriptors;var m=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var x=(s,e,t)=>e in s?U(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,o=(s,e)=>{for(var t in e||(e={}))O.call(e,t)&&x(s,t,e[t]);if(m)for(var t of m(e))N.call(e,t)&&x(s,t,e[t]);return s},l=(s,e)=>T(s,M(e));Object.defineProperty(exports,"__esModule",{value:!0});exports[Symbol.toStringTag]="Module";var n=require("react");const g=n.createContext(void 0),A=g.Provider,D=g.Consumer;g.displayName="SupabaseContext";function S(){const s=n.useContext(g);if(s===void 0)throw Error("No client has been specified using Provider.");return s}function F(s){const e=S();n.useEffect(()=>{const{data:t}=e.auth.onAuthStateChange(s);return()=>{t==null||t.unsubscribe()}},[])}const R={error:void 0,fetching:!1};function $(s={}){const e=S(),[t,r]=n.useState(R),c=n.useCallback(async(u,a)=>{r(l(o({},R),{fetching:!0}));const{error:f}=await e.auth.api.resetPasswordForEmail(u,a!=null?a:s.options),i={error:f};return r(l(o({},i),{fetching:!1})),i},[e,s]);return[t,c]}const p={error:void 0,fetching:!1,session:void 0,user:void 0};function B(s={}){const e=S(),[t,r]=n.useState(p),c=n.useCallback(async(u,a)=>{r(l(o({},p),{fetching:!0}));const{error:f,session:i,user:d}=await e.auth.signIn(o({provider:s.provider},u),a!=null?a:s.options),h={error:f,session:i,user:d};return r(l(o({},h),{fetching:!1})),h},[e,s]);return[t,c]}const k={error:void 0,fetching:!1};function H(){const s=S(),[e,t]=n.useState(k),r=n.useCallback(async()=>{t(l(o({},k),{fetching:!0}));const{error:c}=await s.auth.signOut(),u={error:c};return t(l(o({},u),{fetching:!1})),u},[s]);return[e,r]}function _(s={}){const e=S(),[t,r]=n.useState(p),c=n.useCallback(async(u,a)=>{r(l(o({},p),{fetching:!0}));const{error:f,session:i,user:d}=await e.auth.signUp(u,a!=null?a:s.options),h={error:f,session:i,user:d};return r(l(o({},h),{fetching:!1})),h},[e,s]);return[t,c]}const w={count:void 0,data:void 0,error:void 0,fetching:!1};function j(s,e={options:{}}){const t=S(),r=n.useRef(!1),[c,u]=n.useState(w),a=n.useCallback(async(f,i)=>{const d=f!=null?f:e.filter;if(d===void 0)throw Error("delete() should always be combined with `filter`");u(l(o({},w),{fetching:!0}));const h=t.from(s).delete(i!=null?i:e.options),{count:b,data:C,error:v}=await d(h),y={count:b,data:C,error:v};return r.current&&u(l(o({},y),{fetching:!1})),y},[t]);return n.useEffect(()=>(r.current=!0,()=>{r.current=!1}),[]),[c,a]}function q(s,e=[]){return n.useCallback(s,e)}function z(s,e={options:{}}){const t=S(),r=n.useRef(!1),[c,u]=n.useState(w),a=n.useCallback(async(f,i)=>{u(l(o({},w),{fetching:!0}));const{count:d,data:h,error:b}=await t.from(s).insert(f,i!=null?i:e.options),C={count:d,data:h,error:b};return r.current&&u(l(o({},C),{fetching:!1})),C},[t]);return n.useEffect(()=>(r.current=!0,()=>{r.current=!1}),[]),[c,a]}function I(s,e={columns:"*",options:{}}){const t=S(),r=n.useRef(!1),[c,u]=n.useState(l(o({},w),{stale:!1})),a=n.useCallback(async()=>{if(e.pause)return null;u(C=>l(o({},w),{data:C.data,stale:!0,fetching:!0}));const f=t.from(s).select(e.columns,e.options),{count:i,data:d,error:h}=await(e.filter?e.filter(f):f),b={count:i,data:d,error:h};return r.current&&u(l(o({},b),{stale:!1,fetching:!1})),b},[t,e,s]);return n.useEffect(()=>(r.current=!0,a(),()=>{r.current=!1}),[e==null?void 0:e.filter]),[c,a]}function G(s,e={options:{}}){const t=S(),r=n.useRef(!1),[c,u]=n.useState(w),a=n.useCallback(async(f,i,d)=>{const h=i!=null?i:e.filter;if(h===void 0)throw Error("update() should always be combined with `filter`");u(l(o({},w),{fetching:!0}));const b=t.from(s).update(f,d!=null?d:e.options),{count:C,data:v,error:y}=await h(b),E={count:C,data:v,error:y};return r.current&&u(l(o({},E),{fetching:!1})),E},[t]);return n.useEffect(()=>(r.current=!0,()=>{r.current=!1}),[]),[c,a]}function J(s,e={options:{}}){const t=S(),r=n.useRef(!1),[c,u]=n.useState(w),a=n.useCallback(async(f,i,d)=>{const h=d!=null?d:e.filter;u(l(o({},w),{fetching:!0}));const b=t.from(s).upsert(f,i!=null?i:e.options),{count:C,data:v,error:y}=await(h?h(b):b),E={count:C,data:v,error:y};return r.current&&u(l(o({},E),{fetching:!1})),E},[t]);return n.useEffect(()=>(r.current=!0,()=>{r.current=!1}),[]),[c,a]}function P(s,e={event:"*",table:"*"}){const t=S();n.useEffect(()=>{var c,u;const r=t.from((c=e.table)!=null?c:"*").on((u=e.event)!=null?u:"*",s).subscribe();return()=>{r.unsubscribe()}},[])}function K(s,e,t=(r,c)=>r.id===c.id){if(s==="*")throw Error("Must specify table or row. Cannot listen for all database changes.");const[r,c]=I(s,e==null?void 0:e.select),[u,a]=n.useReducer(L(t),r);return P(f=>a({type:"SUBSCRIPTION",payload:f}),{table:s}),n.useEffect(()=>{a({type:"FETCH",payload:r})},[r]),[u,c]}const L=s=>(e,t)=>{var c;const r=e.data;switch(t.type){case"FETCH":return o(l(o({},e),{old:r}),t.payload);case"SUBSCRIPTION":switch(t.payload.eventType){case"DELETE":return l(o({},e),{data:(c=e.data)==null?void 0:c.filter(u=>!s(u,t.payload.old)),fetching:!1,old:r});case"INSERT":return l(o({},e),{data:[...r!=null?r:[],t.payload.new],fetching:!1,old:r});case"UPDATE":{const u=r!=null?r:[],a=u.findIndex(f=>s(f,t.payload.new));return l(o({},e),{data:[...u.slice(0,a),t.payload.new,...u.slice(a+1)],fetching:!1,old:r})}}}};exports.Consumer=D;exports.Context=g;exports.Provider=A;exports.useAuthStateChange=F;exports.useClient=S;exports.useDelete=j;exports.useFilter=q;exports.useInsert=z;exports.useRealtime=K;exports.useResetPassword=$;exports.useSelect=I;exports.useSignIn=B;exports.useSignOut=H;exports.useSignUp=_;exports.useSubscription=P;exports.useUpdate=G;exports.useUpsert=J;
